"use strict";angular.module("g1b.datetime-range",["g1b.scroll-events"]).directive("datetimeRange",["$document","$timeout",function(e,t){return{restrict:"E",scope:{start:"=",end:"=",presets:"=?",minDate:"=?",maxDate:"=?",onChange:"&?",onChangeStart:"&?",onChangeEnd:"&?",onClose:"&?"},replace:!0,template:'<div class="datetime-range"><div class="start-datetime" ng-click="selectDate(start)" ng-class="{\'active\': selected === start, \'warning\': warning === \'start\' }"><div class="time" ng-bind="start.format(\'HH : mm : ss\')"></div></div><div class="end-datetime" ng-click="selectDate(end)" ng-class="{\'active\': selected === end, \'warning\': warning === \'end\'}"><div class="time" ng-bind="end.format(\'HH : mm : ss\')"></div></div><div class="presets" ng-show="!!presets"><div class="dots" ng-show="!presetsActive" ng-click="presetsActive = !presetsActive"><div class="dot" ng-repeat="dot in \'.....\' track by $index"></div></div><div class="list" ng-class="{\'active\': !!presetsActive}"><div class="preset-button" ng-repeat="preset in presets" ng-click="selectPreset(preset)" ng-bind="preset.name"></div></div></div><div class="edit-popover" ng-show="!!selected"><div class="timer"><div class="timer-hours" scroll-up="setDate(selected.clone().add(1, \'hours\'))" scroll-down="setDate(selected.clone().subtract(1, \'hours\'))"><div class="arrow arrow-up" ng-click="setDate(selected.clone().add(1, \'hours\'))"></div><span ng-bind="selected.format(\'HH\')"></span><div class="arrow arrow-down" ng-click="setDate(selected.clone().subtract(1, \'hours\'))"></div></div><div class="timer-divider">:</div><div class="timer-minutes" scroll-up="setDate(selected.clone().add(1, \'minutes\'))" scroll-down="setDate(selected.clone().subtract(1, \'minutes\'))"><div class="arrow arrow-up" ng-click="setDate(selected.clone().add(1, \'minutes\'))"></div><span ng-bind="selected.format(\'mm\')"></span><div class="arrow arrow-down" ng-click="setDate(selected.clone().subtract(1, \'minutes\'))"></div></div><div class="timer-divider">:</div><div class="timer-seconds" scroll-up="setDate(selected.clone().add(1, \'seconds\'))" scroll-down="setDate(selected.clone().subtract(1, \'seconds\'))"><div class="arrow arrow-up" ng-click="setDate(selected.clone().add(1, \'seconds\'))"></div><span ng-bind="selected.format(\'ss\')"></span><div class="arrow arrow-down" ng-click="setDate(selected.clone().subtract(1, \'seconds\'))"></div></div></div><div class="close-button"><div ng-click="close()">Cerrar</div></div></div></div>',compile:function(){return{pre:function(){},post:function(s,n){s.current=moment(),s.start&&!s.start._isAMomentObject&&(s.start=moment(s.start)),s.end&&!s.end._isAMomentObject&&(s.end=moment(s.end)),s.getNumWeeks=function(){if(s.calendar){var e=s.calendar.clone().startOf("week").weekday(),t=s.calendar.clone().startOf("month"),n=(s.calendar.clone().endOf("month"),(t.weekday()-e+7)%7);return Math.ceil((n+s.calendar.daysInMonth())/7)}},s.selectDate=function(e){s.selected===e?s.selected=void 0:(s.selected=e,s.calendar=s.selected.clone(),s.presetsActive=!1)},s.isWithinBounds=function(e){return(!s.minDate||e>s.minDate)&&(!s.maxDate||e<s.maxDate)},s.setDate=function(e,n){!s.selected.isSame(e)&&s.isWithinBounds(e)&&(s.selected===s.start&&e<s.end||s.selected===s.end&&e>s.start?(s.selected.year(e.year()).month(e.month()).date(e.date()).hours(e.hours()).minutes(e.minutes()).seconds(e.seconds()),(s.selected.clone().startOf("week").month()!==s.calendar.month()&&s.selected.clone().endOf("week").month()!==s.calendar.month()||n)&&(s.calendar=s.selected.clone()),s.selected===s.start&&s.callbackStart(),s.selected===s.end&&s.callbackEnd(),s.callbackAll()):(s.warning=s.selected===s.start?"end":"start",t(function(){s.warning=void 0},250)))},s.selectPreset=function(e){s.close(),s.start.isSame(e.start)&&s.end.isSame(e.end)||(s.start.isSame(e.start)||(s.start=e.start.clone(),s.callbackStart()),s.end.isSame(e.end)||(s.end=e.end.clone(),s.callbackEnd()),s.callbackAll())},s.callbackStart=function(){s.onChangeStart&&t(function(){s.onChangeStart()})},s.callbackEnd=function(){s.onChangeEnd&&t(function(){s.onChangeEnd()})},s.callbackAll=function(){s.onChange&&t(function(){s.onChange()})},s.close=function(){s.selected="",s.presetsActive=!1,s.calendarActive=!1,s.onClose&&s.onClose()},e.on("mousedown",function(e){n[0].contains(e.target)||!s.presetsActive&&!s.selected||s.$apply(function(){s.close()})}),e.on("keyup",function(e){27===e.keyCode&&(s.presetsActive||s.selected)&&s.$apply(function(){s.close()})})}}}}}]);